<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Brand Positioning Spectrum</title>

    <!-- (styles unchanged) -->
    <style>
        /* your full CSS exactly as-is */
    </style>
</head>

<body>
    <div class="container">
        <div class="header">
            <h1>Brand Positioning Spectrum</h1>
            <p>Define your brand's position across key dimensions</p>
        </div>

        <div class="card">
            <div class="spectrum-container" id="spectrumContainer"></div>
            <div class="instructions">
                <p>Drag the handles to adjust your brand's range</p>
            </div>
        </div>
    </div>

<script>
/* =====================================================
   ⭐ PROJECT SCOPING (URL → project identity)
   ===================================================== */
const params = new URLSearchParams(window.location.search);
const projectId = params.get('project') || 'default';
const STORAGE_KEY = `brand-spectrum-${projectId}`;


/* =====================================================
   ⭐ DIMENSIONS (unchanged)
   ===================================================== */
const dimensions = [
    { id: 'people', label: 'People', leftLabel: 'Mass', rightLabel: 'Elite/Niche', color: '#FF6B6B', rangeStart: 50, rangeEnd: 70, examples: ['', '', '', ''] },
    { id: 'tone', label: 'Tone', leftLabel: 'Playful', rightLabel: 'Serious', color: '#4ECDC4', rangeStart: 50, rangeEnd: 70, examples: ['', '', '', ''] },
    { id: 'power', label: 'Power', leftLabel: 'Accessible', rightLabel: 'Authoritative', color: '#45B7D1', rangeStart: 50, rangeEnd: 70, examples: ['', '', '', ''] },
    { id: 'time', label: 'Time', leftLabel: 'Timeless', rightLabel: 'Trendy', color: '#FFA07A', rangeStart: 50, rangeEnd: 70, examples: ['', '', '', ''] },
    { id: 'innovation', label: 'Innovation', leftLabel: 'Familiar', rightLabel: 'Disruptive', color: '#98D8C8', rangeStart: 50, rangeEnd: 70, examples: ['', '', '', ''] },
    { id: 'emotion', label: 'Emotion', leftLabel: 'Rational', rightLabel: 'Emotional', color: '#F7DC6F', rangeStart: 50, rangeEnd: 70, examples: ['', '', '', ''] },
    { id: 'price', label: 'Price', leftLabel: 'Budget', rightLabel: 'Premium', color: '#BB8FCE', rangeStart: 50, rangeEnd: 70, examples: ['', '', '', ''] },
    { id: 'complexity', label: 'Complexity', leftLabel: 'Simple', rightLabel: 'Sophisticated', color: '#85C1E2', rangeStart: 50, rangeEnd: 70, examples: ['', '', '', ''] },
    { id: 'visual', label: 'Visual Style', leftLabel: 'Minimal', rightLabel: 'Maximal', color: '#F8B739', rangeStart: 50, rangeEnd: 70, examples: ['', '', '', ''] },
];


/* =====================================================
   ⭐ STATE OBJECTS (THE THINGS WE SAVE)
   ===================================================== */
const ranges = {};
dimensions.forEach(d => {
    ranges[d.id] = { start: d.rangeStart, end: d.rangeEnd };
});

const examples = {};
dimensions.forEach(d => {
    examples[d.id] = [...d.examples];
});


/* =====================================================
   ⭐ LOAD SAVED STATE (MUST HAPPEN HERE)
   ===================================================== */
const saved = localStorage.getItem(STORAGE_KEY);
if (saved) {
    try {
        const data = JSON.parse(saved);
        Object.assign(ranges, data.ranges || {});
        Object.assign(examples, data.examples || {});
    } catch (e) {
        console.warn('Failed to load saved state', e);
    }
}


/* =====================================================
   ⭐ SAVE HELPER (CALLED ON EVERY CHANGE)
   ===================================================== */
function saveState() {
    localStorage.setItem(
        STORAGE_KEY,
        JSON.stringify({ ranges, examples })
    );
}


/* =====================================================
   UI LOGIC (UNCHANGED EXCEPT SAVE CALLS)
   ===================================================== */
function updateRange(dimensionId, rangeBar, startMarker, endMarker, valueDisplay) {
    const start = ranges[dimensionId].start;
    const end = ranges[dimensionId].end;

    rangeBar.style.left = `${start}%`;
    rangeBar.style.width = `${end - start}%`;
    startMarker.style.left = `${start}%`;
    endMarker.style.left = `${end}%`;

    valueDisplay.innerHTML = `
        <span>${start.toFixed(0)}%</span>
        <span>Range: ${(end - start).toFixed(0)}%</span>
        <span>${end.toFixed(0)}%</span>
    `;
}


function createDimensionRow(dimension) {
    const row = document.createElement('div');
    row.className = 'dimension-row';

    const wrapper = document.createElement('div');
    wrapper.className = 'spectrum-wrapper';

    /* ---------- inputs ---------- */
    const exampleBlocks = document.createElement('div');
    exampleBlocks.className = 'example-blocks';

    examples[dimension.id].forEach((value, index) => {
        const input = document.createElement('input');
        input.className = 'example-input';
        input.value = value;

        input.addEventListener('input', e => {
            examples[dimension.id][index] = e.target.value;
            saveState(); // ⭐ SAVE ON INPUT
        });

        exampleBlocks.appendChild(input);
    });

    /* ---------- bar + markers ---------- */
    const barContainer = document.createElement('div');
    barContainer.className = 'spectrum-bar-container';

    const rangeBar = document.createElement('div');
    rangeBar.className = 'spectrum-range';

    const startMarker = document.createElement('div');
    const endMarker = document.createElement('div');

    let activeMarker = null;

    const handleMouseUp = () => {
        if (activeMarker) saveState(); // ⭐ SAVE AFTER DRAG
        activeMarker = null;
    };

    const handleBarClick = e => {
        const rect = barContainer.getBoundingClientRect();
        const pct = ((e.clientX - rect.left) / rect.width) * 100;

        if (Math.abs(pct - ranges[dimension.id].start) <
            Math.abs(pct - ranges[dimension.id].end)) {
            ranges[dimension.id].start = Math.min(pct, ranges[dimension.id].end - 1);
        } else {
            ranges[dimension.id].end = Math.max(pct, ranges[dimension.id].start + 1);
        }

        updateRange(dimension.id, rangeBar, startMarker, endMarker, valueDisplay);
        saveState(); // ⭐ SAVE ON CLICK
    };

    document.addEventListener('mouseup', handleMouseUp);
    barContainer.addEventListener('click', handleBarClick);

    /* ---------- assemble ---------- */
    wrapper.appendChild(exampleBlocks);
    wrapper.appendChild(barContainer);
    row.appendChild(wrapper);

    return row;
}


/* =====================================================
   ⭐ INIT (RENDER AFTER LOAD)
   ===================================================== */
const container = document.getElementById('spectrumContainer');
dimensions.forEach(d => {
    container.appendChild(createDimensionRow(d));
});
</script>
</body>
</html>
